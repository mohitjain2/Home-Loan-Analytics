<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Value Prediction</title>
    <link rel="stylesheet" href="resources/css/predictions.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="header">
        <h3>Loan Insight</h3>
        <a href="index.html">Home</a>
    </div>

    <div class="container">
        <h2>User Dashboard</h2>
        <p>Welcome to the Loan Insight Prediction Portal. Use our tools to explore property value chances.</p>
        <form id="loanForm">
        <div class="input-boxes">

            <!-- First Name -->
            <div class="input-box">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" placeholder="Enter your first name">
            </div>

            <!-- Last Name -->
            <div class="input-box">
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" placeholder="Enter your last name">
            </div>

            <!-- Credit Score -->
            <!-- <div class="input-box">
                <label for="creditScore">Credit Score</label>
                <input type="number" id="creditScore" placeholder="Enter your credit score">
            </div> -->

            <!-- 1. Loan Amount -->
            <div class="input-box">
                <label for="loanAmount">Loan Amount</label>
                <input type="number" id="loanAmount" placeholder="Enter loan amount">
            </div>

            <!-- 2. Loan-to-Value Ratio -->
            <div class="input-box">
                <label for="loanToValue">Loan-to-Value Ratio</label>
                <input type="number" id="loanToValue" placeholder="Enter LTV ratio">
            </div>

            <!-- 3. Interest Rate -->
            <div class="input-box">
                <label for="interestRate">Interest Rate</label>
                <input type="number" id="interestRate" placeholder="Enter interest rate">
            </div>

            <!-- 4. Loan Term -->
            <div class="input-box">
                <label for="loanTerm">Loan Term (months)</label>
                <input type="number" id="loanTerm" placeholder="Enter loan term in months">
            </div>

            <!-- 6. Total Units -->
            <div class="input-box">
                <label for="totalUnits">Total Units</label>
                <input type="number" id="totalUnits" placeholder="Enter total units on property">
            </div>

            <!-- 7. Income -->
            <div class="input-box">
                <label for="income">Annual Income</label>
                <input type="number" id="income" placeholder="Enter your income">
            </div>

            <!-- 8. Tract Population -->
            <div class="input-box">
                <label for="tractPopulation">Tract Population</label>
                <input type="number" id="tractPopulation" placeholder="Population in your census tract">
            </div>

            <!-- 9. Tract Minority Population % -->
            <div class="input-box">
                <label for="tractMinorityPercent">Tract Minority Population %</label>
                <input type="number" id="tractMinorityPercent" placeholder="e.g. 35 for 35%">
            </div>

            <!-- 10. FFIEC Median Family Income -->
            <div class="input-box">
                <label for="medianFamilyIncome">Median Family Income (MSA)</label>
                <input type="number" id="medianFamilyIncome" placeholder="Enter MSA family income">
            </div>

            <!-- 11. Tract-to-MSA Income % -->
            <div class="input-box">
                <label for="tractToMsaIncome">Tract-to-MSA Income %</label>
                <input type="number" id="tractToMsaIncome" placeholder="e.g. 85 for 85%">
            </div>

            <div class="input-box">
                <label for="co-applicant_age">Co-Applicant age</label>
                <input type="number" id="co-applicant_age" placeholder="Enter Co-Applicant age">
            </div>

            <!-- 12. Owner Occupied Units -->
            <div class="input-box">
                <label for="ownerOccupied">Owner Occupied Units</label>
                <input type="number" id="ownerOccupied" placeholder="Enter number of occupied units">
            </div>

            <!-- 13. Median Age of Housing -->
            <div class="input-box">
                <label for="medianAge">Median Age of Housing Units</label>
                <input type="number" id="medianAge" placeholder="Enter median housing age">
            </div>

            <!-- 14. Purchaser Type -->
            <div class="input-box">
                <label for="purchaserType">Purchaser Type</label>
                <select id="purchaserType">
                    <option value="">Select</option>
                    <option value="0">0 - Not originated/sold</option>
                    <option value="1">1 - Fannie Mae</option>
                    <option value="2">2 - Ginnie Mae</option>
                    <option value="3">3 - Freddie Mac</option>
                    <option value="4">4 - Farmer Mac</option>
                    <option value="5">5 - Private Securitization</option>
                    <option value="6">6 - Bank/Credit Union</option>
                    <option value="7">7 - Insurance Company</option>
                    <option value="8">8 - Affiliate Institution</option>
                    <option value="9">9 - Other</option>
                    <option value="10">10 - Not Applicable</option>
                </select>
            </div>

            <!-- 15. Applicant Credit Score Type -->
            <div class="input-box">
                <label for="applicantCreditScore">Applicant Credit Score Type</label>
                <select id="applicantCreditScore">
                    <option value="">Select</option>
                    <option value="1">1 - Equifax Beacon 5.0</option>
                    <option value="2">2 - Experian FICO</option>
                    <option value="3">3 - TransUnion FICO</option>
                    <option value="4">4 - VantageScore 2.0</option>
                    <option value="5">5 - VantageScore 3.0</option>
                    <option value="6">6 - Other</option>
                    <option value="7">7 - Not provided</option>
                    <option value="8">8 - Not applicable</option>
                </select>
            </div>

            <!-- 16. Co-Applicant Credit Score Type -->
            <div class="input-box">
                <label for="coApplicantCreditScore">Co-Applicant Credit Score Type</label>
                <select id="coApplicantCreditScore">
                    <option value="">Select</option>
                    <option value="1">1 - Equifax Beacon 5.0</option>
                    <option value="2">2 - Experian FICO</option>
                    <option value="3">3 - TransUnion FICO</option>
                    <option value="4">4 - VantageScore 2.0</option>
                    <option value="5">5 - VantageScore 3.0</option>
                    <option value="6">6 - Other</option>
                    <option value="7">7 - Not provided</option>
                    <option value="8">8 - Not applicable</option>
                </select>
            </div>

            <!-- 17-27: All Yes/No Dropdowns -->
            <div class="input-box">
                <label for="preapproval">Preapproval</label>
                <select id="preapproval">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="negativeAmortization">Negative Amortization</label>
                <select id="negativeAmortization">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="interestOnly">Interest Only Payment</label>
                <select id="interestOnly">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="balloonPayment">Balloon Payment</label>
                <select id="balloonPayment">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="otherFeatures">Other Nonamortizing Features</label>
                <select id="otherFeatures">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="applicantAge62">Applicant Age ≥ 62</label>
                <select id="applicantAge62">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="coApplicantAge62">Co-Applicant Age ≥ 62</label>
                <select id="coApplicantAge62">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="conventionalSubordinateLien">Conventional: Subordinate Lien</label>
                <select id="conventionalSubordinateLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="fhaLien">FHA: First Lien</label>
                <select id="fhaLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="fhaSubordinateLien">FHA: Subordinate Lien</label>
                <select id="fhaSubordinateLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="fsaLien">FSA/RHS: First Lien</label>
                <select id="fsaLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="fsaSubordinateLien">FSA: Subordinate Lien</label>
                <select id="fsaSubordinateLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="vaLien">VA: First Lien</label>
                <select id="vaLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="vaSubordinateLien">VA: Subordinate Lien</label>
                <select id="vaSubordinateLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="multifamilyDwelling">Multifamily: Site-Built</label>
                <select id="multifamilyDwelling">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="singlefamilyDwelling">Single family: Mahufactured</label>
                <select id="singlefamilyDwelling">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="conforming_loan_limit">Conforming loan limit</label>
                <select id="conforming_loan_limit">
                    <option value="">Select</option>
                    <option value="0">Not Conforming</option>
                    <option value="1">Comforming</option>
                </select>
            </div>

            <div class="input-box">
                <label for="loan_purpose">Loan purpose</label>
                <select id="loan_purpose">
                    <option value="">Select</option>
                    <option value="2">Home Improvement</option>
                    <option value="4">Other Purpose</option>
                    <option value="5">Construction</option>
                    <option value="31">Cash-Out Refinance</option>
                    <option value="32">Other Refinance</option>
                </select>
            </div>

            <div class="input-box">
                <label for="occupancy_type_2">Occupancy type</label>
                <select id="occupancy_type_2">
                    <option value="">Select</option>
                    <option value="2">Second residence</option>
                    <option value="3">Investment property</option>
                </select>
            </div>

            <div class="input-box">
                <label for="manufactured_home_secured_property_type">Manufactured Home Secured Property</label>
                <select id="manufactured_home_secured_property_type">
                    <option value="">Select</option>
                    <option value="2">Home Only</option>
                    <option value="1111">N/A</option>
                </select>
            </div>

            <div class="input-box">
                <label for="manufactured_home_land_property_interest">Manufactured Home Land Property</label>
                <select id="manufactured_home_land_property_interest">
                    <option value="">Select</option>
                    <option value="2">Indirect Ownership</option>
                    <option value="3">Paid Leashold</option>
                    <option value="4">Unpaid Leashold</option>
                </select>
            </div>

            <div class="input-box">
                <label for="openEndCredit">Open-end Line of Credit</label>
                <select id="openEndCredit">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="reverseMortgage">Reverse Mortgage</label>
                <select id="reverseMortgage">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
            <div class="input-box">
                <label for="submission_of_application">Submission of Applicatoion</label>
                <select id="submission_of_application">
                    <option value="">Select</option>
                    <option value="2">Submitted via broker</option>
                    <option value="1111">N/A</option>
                </select>
            </div>
            <div class="input-box">
                <label for="initially_payable_to_institution_2">Initially Payable to Institution</label>
                <select id="initially_payable_to_institution_2">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
    
            <div class="input-box">
                <label for="business_or_commercial_purpose">Loan is for Business/Commercial Purpose?</label>
                <select id="business_or_commercial_purpose">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
        </div>
        <!-- Submit Button -->
        <button class="submit-btn">Submit</button>
    </form>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
          document.getElementById('loanForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            if (!this.checkValidity()) {
              this.reportValidity();
              return;
            }
            console.log("Form submitted");
        
            // 1) Grab the right IDs (with “_2” suffixes) and .value
            const loan_purpose = document.getElementById('loan_purpose').value;
            const submission = document.getElementById('submission_of_application').value;
            const occupancy = document.getElementById('occupancy_type_2').value;               // <-- was occupancy_type
            const mhspt = document.getElementById('manufactured_home_secured_property_type').value;
            const mhlpi = document.getElementById('manufactured_home_land_property_interest').value;
            const conforming = document.getElementById('conforming_loan_limit').value;         // <-- added .value
            const conventional = document.getElementById('conventionalSubordinateLien').value;
            const fhaLien      = document.getElementById('fhaLien').value;
            const fhaSub       = document.getElementById('fhaSubordinateLien').value;
            const fsaLien      = document.getElementById('fsaLien').value;
            const fsaSub       = document.getElementById('fsaSubordinateLien').value;
            const vaLien       = document.getElementById('vaLien').value;
            const vaSub        = document.getElementById('vaSubordinateLien').value;
            const multiDw      = document.getElementById('multifamilyDwelling').value;
            const singleDw     = document.getElementById('singlefamilyDwelling').value;

        
            const data = {
              purchaser_type:                parseInt(document.getElementById('purchaserType').value),
              preapproval:                   parseInt(document.getElementById('preapproval').value),
              reverse_mortgage:              parseInt(document.getElementById('reverseMortgage').value),
              'open-end_line_of_credit':     parseInt(document.getElementById('openEndCredit').value),
              business_or_commercial_purpose:parseInt(document.getElementById('business_or_commercial_purpose').value),
              loan_amount:                   parseFloat(document.getElementById('loanAmount').value),
              loan_to_value_ratio:           parseFloat(document.getElementById('loanToValue').value),
              interest_rate:                 parseFloat(document.getElementById('interestRate').value),
              loan_term:                     parseInt(document.getElementById('loanTerm').value),
              negative_amortization:         parseInt(document.getElementById('negativeAmortization').value),
              interest_only_payment:         parseInt(document.getElementById('interestOnly').value),
              balloon_payment:               parseInt(document.getElementById('balloonPayment').value),
              other_nonamortizing_features:  parseInt(document.getElementById('otherFeatures').value),
              total_units:                   parseInt(document.getElementById('totalUnits').value),
              income:                        parseFloat(document.getElementById('income').value),
              applicant_credit_score_type:   parseInt(document.getElementById('applicantCreditScore').value),
              'co-applicant_credit_score_type': parseInt(document.getElementById('coApplicantCreditScore').value),
              'co-applicant_age':             parseInt(document.getElementById('co-applicant_age').value),
              applicant_age_above_62:         parseInt(document.getElementById('applicantAge62').value),
              'co-applicant_age_above_62':      parseInt(document.getElementById('coApplicantAge62').value),
              tract_population:               parseInt(document.getElementById('tractPopulation').value),
              tract_minority_population_percent: parseFloat(document.getElementById('tractMinorityPercent').value),
              ffiec_msa_md_median_family_income: parseFloat(document.getElementById('medianFamilyIncome').value),
              tract_to_msa_income_percentage: parseFloat(document.getElementById('tractToMsaIncome').value),
              tract_owner_occupied_units:    parseInt(document.getElementById('ownerOccupied').value),
              tract_median_age_of_housing_units: parseInt(document.getElementById('medianAge').value),

              // derived loan product types
                'derived_loan_product_type_Conventional:Subordinate Lien':conventional === "1" ? 1 : 0,
                'derived_loan_product_type_FHA:First Lien':fhaLien === "1" ? 1 : 0,
                'derived_loan_product_type_FHA:Subordinate Lien':fhaSub === "1" ? 1 : 0,
                'derived_loan_product_type_FSA/RHS:First Lien':fsaLien === "1" ? 1 : 0,
                'derived_loan_product_type_FSA/RHS:Subordinate Lien':fsaSub === "1" ? 1 : 0,
                'derived_loan_product_type_VA:First Lien':vaLien === "1" ? 1 : 0,
                'derived_loan_product_type_VA:Subordinate Lien':vaSub === "1" ? 1 : 0,

// derived dwelling categories
'derived_dwelling_category_Multifamily:Site-Built':
    multiDw === "1" ? 1 : 0,
'derived_dwelling_category_Single Family (1-4 Units):Manufactured':
    singleDw === "1" ? 1 : 0,

        
              // 2) Correct the conforming flags (no parseInt on boolean)
              conforming_loan_limit_NC: (conforming === "0") ? 1 : 0,
              conforming_loan_limit_U:  (conforming === "1") ? 1 : 0,
        
              // 3) Reuse the constants for manufactured-home flags
              manufactured_home_secured_property_type_2:   (mhspt === "2") ? 1 : 0,
              manufactured_home_secured_property_type_1111:(mhspt === "1111") ? 1 : 0,
              manufactured_home_land_property_interest_2:   (mhlpi === "2") ? 1 : 0,
              manufactured_home_land_property_interest_3:   (mhlpi === "3") ? 1 : 0,
              manufactured_home_land_property_interest_4:   (mhlpi === "4") ? 1 : 0,
        
              // 4) Toggle occupancy based on occupancy_type_2
              occupancy_type_2: (occupancy === "2") ? 1 : 0,
              occupancy_type_3: (occupancy === "3") ? 1 : 0,
        
              // 5) Use your loan_purpose constant instead of repeating getElementById
              loan_purpose_2:  (loan_purpose === "2")  ? 1 : 0,
              loan_purpose_4:  (loan_purpose === "4")  ? 1 : 0,
              loan_purpose_5:  (loan_purpose === "5")  ? 1 : 0,
              loan_purpose_31: (loan_purpose === "31") ? 1 : 0,
              loan_purpose_32: (loan_purpose === "32") ? 1 : 0,
        
              submission_of_application_2:  (submission === "2")    ? 1 : 0,
              submission_of_application_1111:(submission === "1111")? 1 : 0,
        
              initially_payable_to_institution_2: parseInt(document.getElementById('initially_payable_to_institution_2').value)
            };
        
            try {
              const res = await axios.post(
                'http://localhost:5000/predict_property_value',
                data
              );
              console.log("Server response:", res.data);
              alert(`Predicted Property Value: $${res.data.predicted_property_value}`);
            } catch (err) {
              console.error(err);
              alert("Error submitting form. Check your inputs or try again.");
            }
          });
        });
        </script>
        

</body>
</html>
