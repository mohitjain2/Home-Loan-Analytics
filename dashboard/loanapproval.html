<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Approval Prediction</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="resources/css/predictions.css">
</head>
<body>
    <div class="header">
        <h3>Loan Insight</h3>
        <a href="index.html">Home</a>
    </div>

    <div class="container">
        <h2>User Dashboard</h2>
        <p>Welcome to the Loan Insight Prediction Portal. Use our tools to explore loan approval chances.</p>
        <form id="loanForm">
        <div class="input-boxes">

            <!-- First Name -->
            <div class="input-box">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" placeholder="Enter your first name">
            </div>

            <!-- Last Name -->
            <div class="input-box">
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" placeholder="Enter your last name">
            </div>

            <!-- Credit Score -->
            <div class="input-box">
                <label for="creditScore">Credit Score</label>
                <input type="number" id="creditScore" placeholder="Enter your credit score">
            </div>

            <!-- 1. Loan Amount -->
            <div class="input-box">
                <label for="loanAmount">Loan Amount</label>
                <input type="number" id="loanAmount" placeholder="Enter loan amount" required>
            </div>

            <!-- 2. Loan-to-Value Ratio -->
            <div class="input-box">
                <label for="loanToValue">Loan-to-Value Ratio</label>
                <input type="number" id="loanToValue" placeholder="Enter LTV ratio">
            </div>

            <!-- 3. Interest Rate -->
            <div class="input-box">
                <label for="interestRate">Interest Rate</label>
                <input type="number" id="interestRate" placeholder="Enter interest rate">
            </div>

            <!-- 4. Loan Term -->
            <div class="input-box">
                <label for="loanTerm">Loan Term (months)</label>
                <input type="number" id="loanTerm" placeholder="Enter loan term in months">
            </div>

            <!-- 5. Property Value -->
            <div class="input-box">
                <label for="propertyValue">Property Value</label>
                <input type="number" id="propertyValue" placeholder="Enter property value">
            </div>

            <!-- 6. Total Units -->
            <div class="input-box">
                <label for="totalUnits">Total Units</label>
                <input type="number" id="totalUnits" placeholder="Enter total units on property">
            </div>

            <!-- 7. Income -->
            <div class="input-box">
                <label for="income">Annual Income</label>
                <input type="number" id="income" placeholder="Enter your income">
            </div>

            <!-- 8. Tract Population -->
            <div class="input-box">
                <label for="tractPopulation">Tract Population</label>
                <input type="number" id="tractPopulation" placeholder="Population in your census tract">
            </div>

            <!-- 9. Tract Minority Population % -->
            <div class="input-box">
                <label for="tractMinorityPercent">Tract Minority Population %</label>
                <input type="number" id="tractMinorityPercent" placeholder="e.g. 35 for 35%">
            </div>

            <!-- 10. FFIEC Median Family Income -->
            <div class="input-box">
                <label for="medianFamilyIncome">Median Family Income (MSA)</label>
                <input type="number" id="medianFamilyIncome" placeholder="Enter MSA family income">
            </div>

            <!-- 11. Tract-to-MSA Income % -->
            <div class="input-box">
                <label for="tractToMsaIncome">Tract-to-MSA Income %</label>
                <input type="number" id="tractToMsaIncome" placeholder="e.g. 85 for 85%">
            </div>

            <!-- 12. Owner Occupied Units -->
            <div class="input-box">
                <label for="ownerOccupied">Owner Occupied Units</label>
                <input type="number" id="ownerOccupied" placeholder="Enter number of occupied units">
            </div>

            <!-- 13. Median Age of Housing -->
            <div class="input-box">
                <label for="medianAge">Median Age of Housing Units</label>
                <input type="number" id="medianAge" placeholder="Enter median housing age">
            </div>

            <!-- 14. Purchaser Type -->
            <div class="input-box">
                <label for="purchaserType">Purchaser Type</label>
                <select id="purchaserType">
                    <option value="">Select</option>
                    <option value="0">0 - Not originated/sold</option>
                    <option value="1">1 - Fannie Mae</option>
                    <option value="2">2 - Ginnie Mae</option>
                    <option value="3">3 - Freddie Mac</option>
                    <option value="4">4 - Farmer Mac</option>
                    <option value="5">5 - Private Securitization</option>
                    <option value="6">6 - Bank/Credit Union</option>
                    <option value="7">7 - Insurance Company</option>
                    <option value="8">8 - Affiliate Institution</option>
                    <option value="9">9 - Other</option>
                </select>
            </div>

            <div class="input-box">
                <label for="loan_purpose">Loan purpose</label>
                <select id="loan_purpose">
                    <option value="">Select</option>
                    <option value="2">Home Improvement</option>
                    <option value="4">Other Purpose</option>
                    <option value="5">Construction</option>
                    <option value="31">Cash-Out Refinance</option>
                    <option value="32">Other Refinance</option>
                </select>
            </div>

            <!-- 15. Applicant Credit Score Type -->
            <div class="input-box">
                <label for="applicantCreditScore">Applicant Credit Score Type</label>
                <select id="applicantCreditScore">
                    <option value="">Select</option>
                    <option value="1">1 - Equifax Beacon 5.0</option>
                    <option value="2">2 - Experian FICO</option>
                    <option value="3">3 - TransUnion FICO</option>
                    <option value="4">4 - VantageScore 2.0</option>
                    <option value="5">5 - VantageScore 3.0</option>
                    <option value="6">6 - Other</option>
                    <option value="7">7 - Not provided</option>
                    <option value="8">8 - Not applicable</option>
                </select>
            </div>

            <!-- 16. Co-Applicant Credit Score Type -->
            <div class="input-box">
                <label for="coApplicantCreditScore">Co-Applicant Credit Score Type</label>
                <select id="coApplicantCreditScore">
                    <option value="">Select</option>
                    <option value="1">1 - Equifax Beacon 5.0</option>
                    <option value="2">2 - Experian FICO</option>
                    <option value="3">3 - TransUnion FICO</option>
                    <option value="4">4 - VantageScore 2.0</option>
                    <option value="5">5 - VantageScore 3.0</option>
                    <option value="6">6 - Other</option>
                    <option value="7">7 - Not provided</option>
                    <option value="8">8 - Not applicable</option>
                </select>
            </div>

            <!-- 17-27: All Yes/No Dropdowns -->
            <div class="input-box">
                <label for="preapproval">Preapproval</label>
                <select id="preapproval">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="negativeAmortization">Negative Amortization</label>
                <select id="negativeAmortization">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="interestOnly">Interest Only Payment</label>
                <select id="interestOnly">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="balloonPayment">Balloon Payment</label>
                <select id="balloonPayment">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="otherFeatures">Other Nonamortizing Features</label>
                <select id="otherFeatures">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="applicantAge62">Applicant Age ≥ 62</label>
                <select id="applicantAge62">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="coApplicantAge62">Co-Applicant Age ≥ 62</label>
                <select id="coApplicantAge62">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="fhaLien">FHA: First Lien</label>
                <select id="fhaLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="fsaLien">FSA/RHS: First Lien</label>
                <select id="fsaLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="vaLien">VA: First Lien</label>
                <select id="vaLien">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="multifamilyDwelling">Multifamily: Site-Built</label>
                <select id="multifamilyDwelling">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="derived_dwelling_category_Single Family (1-4 Units):Manufactured">Single Family (1-4 Units):Manufactured</label>
                <select id="derived_dwelling_category_Single Family (1-4 Units):Manufactured">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="openEndCredit">Open-end Line of Credit</label>
                <select id="openEndCredit">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>

            <div class="input-box">
                <label for="reverseMortgage">Reverse Mortgage</label>
                <select id="reverseMortgage">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
            <div class="input-box">
                <label for="occupancy_type_2">Occupancy type</label>
                <select id="occupancy_type_2">
                    <option value="">Select</option>
                    <option value="2">Second residence</option>
                    <option value="3">Investment property</option>
                    <option value="1111">Not applicable</option>
                </select>
            </div>
    
            <div class="input-box">
                <label for="submission_of_application_2">Submission of application</label>
                <select id="submission_of_application_2">
                    <option value="">Select</option>
                    <option value="0">Not submitted directly to the lender</option>
                    <option value="1">Submitted directly to the lender</option>
                </select>
            </div>
    
    
            <div class="input-box">
                <label for="initially_payable_to_institution_2">Initially Payable To Institution</label>
                <select id="initially_payable_to_institution_2">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
     
    
            <div class="input-box">
                <label for="aus">AUS</label>
                <select id="aus">
                    <option value="">Select</option>
                    <option value="2">Desktop Underwriter (DU)</option>
                    <option value="3">Loan Product Advisor</option>
                    <option value="4">TOTAL Scorecard</option>
                    <option value="5">Guaranteed Underwriting System</option>
                    <option value="6">Other AUS</option>
                    <option value="7">AUS not used</option>                
                </select>
            </div>
        </div>
        <!-- Submit Button -->
        <button class="submit-btn">Submit</button>
    </div>
    </form>
    
    </body>
    <script>
        document.getElementById('loanForm').addEventListener('submit', async function (event) {
            event.preventDefault();
        
            if (!this.checkValidity()) {
                this.reportValidity();
                return;
            }
        
            const loan_purpose = document.getElementById('loan_purpose').value;
            const loan_type = document.getElementById('loan_type').value;
        
            const data = {
                interest_rate: parseFloat(document.getElementById('interestRate').value),
                loan_amount: parseFloat(document.getElementById('loanAmount').value),
                loan_term: parseInt(document.getElementById('loanTerm').value),
                
                loan_purpose_2: (loan_purpose === "2") ? 1 : 0,
                loan_purpose_4: (loan_purpose === "4") ? 1 : 0,
                loan_purpose_5: (loan_purpose === "5") ? 1 : 0,
        
                loan_type_2: (loan_type === "2") ? 1 : 0,
                loan_type_3: (loan_type === "3") ? 1 : 0,
        
                lien_status_2: parseInt(document.getElementById('lien_status_2').value),
                negative_amortization: parseInt(document.getElementById('negativeAmortization').value),
                interest_only_payment: parseInt(document.getElementById('interestOnly').value),
                balloon_payment: parseInt(document.getElementById('balloonPayment').value),
                other_nonamortizing_features: parseInt(document.getElementById('otherFeatures').value),
                conforming_loan_limit_NC: parseInt(document.getElementById('conforming_loan_limit_NC').value),
        
                ['derived_loan_product_type_Conventional:Subordinate Lien']: parseInt(document.getElementById('derived_loan_product_type_Conventional:Subordinate Lien').value),
                ['derived_loan_product_type_FHA:First Lien']: parseInt(document.getElementById('fhaLien').value),
                ['derived_loan_product_type_VA:First Lien']: parseInt(document.getElementById('vaLien').value),
                ['derived_loan_product_type_VA:Subordinate Lien']: parseInt(document.getElementById('vaSubordinateLien').value),
        
                applicant_credit_score_type: parseInt(document.getElementById('applicantCreditScore').value),
                ['co-applicant_credit_score_type']: parseInt(document.getElementById('coApplicantCreditScore').value),
                ['co-applicant_age']: parseInt(document.getElementById('co-applicant_age').value),
                applicant_age_above_62: parseInt(document.getElementById('applicantAge62').value),
                occupancy_type_3: parseInt(document.getElementById('occupancy_type_3').value),
        
                manufactured_home_secured_property_type_2: parseInt(document.getElementById('manufactured_home_secured_property_type_2').value),
                manufactured_home_land_property_interest_3: parseInt(document.getElementById('manufactured_home_land_property_interest_3').value),
                submission_of_application_3: parseInt(document.getElementById('submission_of_application_3').value),
                initially_payable_to_institution_3: parseInt(document.getElementById('initially_payable_to_institution_3').value),
                purchaser_type: parseInt(document.getElementById('purchaserType').value),
                business_or_commercial_purpose: parseInt(document.getElementById('business_or_commercial_purpose').value),
                ['open-end_line_of_credit']: parseInt(document.getElementById('openEndCredit').value),
                reverse_mortgage: parseInt(document.getElementById('reverseMortgage').value)
            };
        
            try {
                const response = await axios.post('http://localhost:5000/predict_interest_rate', data);
                alert(`Predicted Interest Rate: ${response.data.predicted_interest_rate.toFixed(2)}%`);
            } catch (error) {
                alert('Error connecting to server: ' + error);
            }
        });
        </script>                     

</body>
</html>
